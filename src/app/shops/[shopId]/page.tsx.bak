/**
 * 고용주가 자신의 가게 정보와 등록한 공고를 확인하는 페이지
 */
"use client";

import React, { useEffect, useState } from "react";
import { useParams, useRouter } from "next/navigation";
import MyShopCard from "@/components/Card/MyShopCard";
import ShopNotices from "@/components/ShopNotices/ShopNotices";
import ShopInfoCard from "@/components/ShopCard/ShopInfoCard";
import { useGetShop } from "@/hooks/api/useShopService";
import { TEST_MODE_CONFIG } from "@/components/ShopNotices/dummyData";

// 목업 데이터
const mockShopData = {
  id: "mock-shop-1",
  name: "목업 테스트 식당",
  category: "식당",
  address1: "서울시 강남구",
  address2: "역삼동 123-45",
  description:
    "목업 데이터로 테스트 중인 가게입니다. 다양한 화면을 확인해보세요!",
  imageUrl: "/temp-restaurant.jpg",
  originalHourlyPay: 12000,
  location: "서울시 강남구",
  userId: "mock-user-id",
};

export default function ShopDetailPage() {
  const router = useRouter();
  const params = useParams();
  const shopId = params.shopId as string;
  const [useMockData, setUseMockData] = useState(false);

  // 목업 데이터 사용 여부 확인
  useEffect(() => {
    setUseMockData(shopId === "mock-test");
  }, [shopId]);

  // 실제 API 연동
  const { data, isLoading, error } = useGetShop(shopId);
  const shop = data?.item;

  // 테스트용 더미 shop 데이터
  const dummyShop = {
    id: "shop-1",
    name: "도토리 식당",
    category: "식당",
    address1: "서울시 송파구",
    address2: "송파동 123-45",
    description: "알바하기 편한 나구리네 라면집!",
    imageUrl: "/temp-restaurant.jpg",
    originalHourlyPay: 11000,
    location: "서울시 송파구",
    userId: "has-shop",
  };

  const isTestMode = TEST_MODE_CONFIG.CURRENT_MODE !== "normal";
  const mappedShop = isTestMode
    ? dummyShop
    : shop && {
        ...shop,
        location: shop.address1,
        userId: shop.user?.item?.id || "",
      };

  // 목업 데이터 사용
  if (useMockData) {
    return (
      <div className="max-w-[964px] mx-auto px-6 py-10">
        <h1 className="text-[28px] font-bold mb-6">내 가게 (목업 테스트)</h1>

        {/* 가게 정보 섹션 */}
        <section className="mb-10">
          <ShopInfoCard shop={mockShopData} />
        </section>

        {/* 공고 섹션 - 분리된 컴포넌트 사용 */}
        <section>
          <ShopNotices shopId={mockShopData.id} />
        </section>
      </div>
    );
  }

  // 실제 API 응답 사용
  if (isLoading) {
    return <div className="text-center py-10">로딩 중...</div>;
  }

  if (!isTestMode && (error || !mappedShop)) {
    return (
      <MyShopCard
        description="내 가게를 소개하고 공고도 등록해 보세요."
        buttonText="가게 등록하기"
        onClick={() => router.push("/shops/new")}
      />
    );
  }

  return (
    <div className="max-w-[964px] mx-auto px-6 py-10">
      <h1 className="text-[28px] font-bold mb-6">내 가게</h1>

      {/* 가게 정보 섹션 */}
      <section className="mb-10">
        <ShopInfoCard shop={mappedShop} />
      </section>

      {/* 공고 섹션 - 분리된 컴포넌트 사용 */}
      <section>
        <ShopNotices shopId={mappedShop.id} />
      </section>
    </div>
  );
}
